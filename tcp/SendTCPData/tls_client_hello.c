// TLSのClientHelloを送信するサンプルプログラム
// gcc tls_client_hello.c
#include <stdio.h>
#include <string.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>

int
main()
{
 struct sockaddr_in server;
 int sock;

 // ClientHello
 //   適当なサイトからwiresharkを起動してから「Secure Socket Layer」を選択して->「パケットバイト列を表示」->「C言語配列で表示」で抜き出すことができる。
 char packet_bytes[] = {
   0x16, 0x03, 0x01, 0x00, 0xc6, 0x01, 0x00, 0x00,
   0xc2, 0x03, 0x03, 0x9a, 0xca, 0x36, 0x34, 0xc6,
   0x80, 0x76, 0xaf, 0xe5, 0x17, 0x7c, 0xfc, 0x00,
   0xbe, 0x4e, 0xe2, 0x7b, 0xe5, 0x43, 0x00, 0x0e,
   0x19, 0xe5, 0xb6, 0x92, 0xb9, 0xec, 0x51, 0x15,
   0xcb, 0x08, 0x9c, 0x00, 0x00, 0x1c, 0x9a, 0x9a,
   0xc0, 0x2b, 0xc0, 0x2f, 0xc0, 0x2c, 0xc0, 0x30,
   0xcc, 0xa9, 0xcc, 0xa8, 0xc0, 0x13, 0xc0, 0x14,
   0x00, 0x9c, 0x00, 0x9d, 0x00, 0x2f, 0x00, 0x35,
   0x00, 0x0a, 0x01, 0x00, 0x00, 0x7d, 0x3a, 0x3a,
   0x00, 0x00, 0xff, 0x01, 0x00, 0x01, 0x00, 0x00,
   0x00, 0x00, 0x14, 0x00, 0x12, 0x00, 0x00, 0x0f,
   0x77, 0x77, 0x77, 0x2e, 0x79, 0x61, 0x68, 0x6f,
   0x6f, 0x2e, 0x63, 0x6f, 0x2e, 0x6a, 0x70, 0x00,
   0x17, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00,
   0x0d, 0x00, 0x14, 0x00, 0x12, 0x04, 0x03, 0x08,
   0x04, 0x04, 0x01, 0x05, 0x03, 0x08, 0x05, 0x05,
   0x01, 0x08, 0x06, 0x06, 0x01, 0x02, 0x01, 0x00,
   0x05, 0x00, 0x05, 0x01, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x12, 0x00, 0x00, 0x00, 0x10, 0x00, 0x0e,
   0x00, 0x0c, 0x02, 0x68, 0x32, 0x08, 0x68, 0x74,
   0x74, 0x70, 0x2f, 0x31, 0x2e, 0x31, 0x75, 0x50,
   0x00, 0x00, 0x00, 0x0b, 0x00, 0x02, 0x01, 0x00,
   0x00, 0x0a, 0x00, 0x0a, 0x00, 0x08, 0xca, 0xca,
   0x00, 0x1d, 0x00, 0x17, 0x00, 0x18, 0x2a, 0x2a,
   0x00, 0x01, 0x00
 };

 /* ソケットの作成 */
 sock = socket(PF_INET, SOCK_STREAM, 0);

 /* 接続先指定用構造体の準備 */
 server.sin_family = PF_INET;
 server.sin_port = htons(443);
 server.sin_addr.s_addr = inet_addr("127.0.0.1");

 /* サーバに接続 */
 connect(sock, (struct sockaddr *)&server, sizeof(server));

 /* サーバへデータを送信 */
 write(sock, packet_bytes, sizeof(packet_bytes));
 //printf("%d, %s\n", n, buf);

 /* socketの終了 */
 close(sock);

 return 0;
}
